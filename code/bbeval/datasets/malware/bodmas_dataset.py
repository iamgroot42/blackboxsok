import os

import bodmas.multiple_data as multiple_data
from bbeval.datasets.base import CustomDatasetWrapper
from bbeval.config import DatasetConfig
import torch as ch
import pandas as pd
from pefile import PE
from torch.utils.data import TensorDataset


class BODMASWrapper(CustomDatasetWrapper):
    def __init__(self, data_config: DatasetConfig):
        super().__init__(data_config, num_classes=2)
        armed_files = os.path.join(self.root, "armed")

        # Load data
        X_train_origin, y_train_origin, \
        X_test_list, y_test_list = multiple_data.load_bluehex_data(
                                    task="binary",
                                    test_begin_time="2019-10",
                                    test_end_time="2020-09",
                                    families_cnt=2,
                                    is_normalize=False,
                                    general_data_folder=self.root,
                                    setting_data_folder=None,
                                    saved_data_path=os.path.join(self.root, "saved"))

        wanted_test = 0
        self.ds_train = TensorDataset(ch.from_numpy(X_train_origin), ch.from_numpy(y_train_origin))
        self.ds_test = TensorDataset(ch.from_numpy(X_test_list[wanted_test]), ch.from_numpy(y_test_list[wanted_test]))
    
