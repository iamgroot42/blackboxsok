import os
import magic
from bbeval.datasets.malware.base import MalwareFilesDataset, MalwareDatasetWrapper


class CleanPHDWrapper(MalwareDatasetWrapper):
    def __init__(self):
        self.root = "/p/blackboxsok/phd-dataset"
        clean_train_folder = os.path.join(self.root, "train01-final/clean/files_all")
        all_files = os.listdir(clean_train_folder)
        all_files = all_files[:100]
        all_files = list(filter(lambda path: "PE32" in magic.from_file(os.path.join(all_files, path)), all_files))
        all_files = list(map(lambda path: os.path.join(all_files, path), all_files))

        # Load data
        self.ds_train = MalwareFilesDataset(all_files)
        self.ds_test = MalwareFilesDataset(all_files)
        self.ds_val = MalwareFilesDataset(all_files)
